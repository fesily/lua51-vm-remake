function put1(t, v) t.a1 = v end
function put2(t, v) t.a2 = v end
function put3(t, v) t.a3 = v end
function put4(t, v) t.a4 = v end
function put5(t, v) t.a5 = v end
function put6(t, v) t.a6 = v end
function put7(t, v) t.a7 = v end
function put8(t, v) t.a8 = v end
function put9(t, v) t.a9 = v end
function put10(t, v) t.a10 = v end
function put11(t, v) t.a11 = v end
function put12(t, v) t.a12 = v end
function put13(t, v) t.a13 = v end
function put14(t, v) t.a14 = v end
function put15(t, v) t.a15 = v end
function put16(t, v) t.a16 = v end
function put17(t, v) t.a17 = v end
function put18(t, v) t.a18 = v end
function put19(t, v) t.a19 = v end
function put20(t, v) t.a20 = v end
function put21(t, v) t.a21 = v end
function put22(t, v) t.a22 = v end
function put23(t, v) t.a23 = v end
function put24(t, v) t.a24 = v end
function put25(t, v) t.a25 = v end
function put26(t, v) t.a26 = v end
function put27(t, v) t.a27 = v end
function put28(t, v) t.a28 = v end
function put29(t, v) t.a29 = v end
function put30(t, v) t.a30 = v end
function put31(t, v) t.a31 = v end
function put32(t, v) t.a32 = v end
function put33(t, v) t.a33 = v end
function put34(t, v) t.a34 = v end
function put35(t, v) t.a35 = v end
function put36(t, v) t.a36 = v end
function put37(t, v) t.a37 = v end
function put38(t, v) t.a38 = v end
function put39(t, v) t.a39 = v end
function put40(t, v) t.a40 = v end
function put41(t, v) t.a41 = v end
function put42(t, v) t.a42 = v end
function put43(t, v) t.a43 = v end
function put44(t, v) t.a44 = v end
function put45(t, v) t.a45 = v end
function put46(t, v) t.a46 = v end
function put47(t, v) t.a47 = v end
function put48(t, v) t.a48 = v end
function put49(t, v) t.a49 = v end
function put50(t, v) t.a50 = v end

function create_tab_1()
	t = {
		x1 = "123",
		x2 = 45.6
	}
	for i=1,500 do
		t["y"..i] = i+10000
	end
	return t
end

function create_tab_2()
	t = {
		x1 = 6,
		x2 = 5,
		[1] = 4,
		[2] = 3
	}
	for i=1,500 do
		t["y"..i] = i+10000
	end
	return t
end

function dotest_impl(t1, t2)

put1(t1, 100+1)
print(t1.a1, t2.a1)
put1(t1, 200+1)
print(t1.a1, t2.a1)
put1(t2, 300+1)
print(t1.a1, t2.a1)
put1(t2, 400+1)
print(t1.a1, t2.a1)
put1(t1, 500+1)
print(t1.a1, t2.a1)
put1(t2, 600+1)
print(t1.a1, t2.a1)
put2(t1, 100+2)
print(t1.a2, t2.a2)
put2(t1, 200+2)
print(t1.a2, t2.a2)
put2(t2, 300+2)
print(t1.a2, t2.a2)
put2(t2, 400+2)
print(t1.a2, t2.a2)
put2(t1, 500+2)
print(t1.a2, t2.a2)
put2(t2, 600+2)
print(t1.a2, t2.a2)
put3(t1, 100+3)
print(t1.a3, t2.a3)
put3(t1, 200+3)
print(t1.a3, t2.a3)
put3(t2, 300+3)
print(t1.a3, t2.a3)
put3(t2, 400+3)
print(t1.a3, t2.a3)
put3(t1, 500+3)
print(t1.a3, t2.a3)
put3(t2, 600+3)
print(t1.a3, t2.a3)
put4(t1, 100+4)
print(t1.a4, t2.a4)
put4(t1, 200+4)
print(t1.a4, t2.a4)
put4(t2, 300+4)
print(t1.a4, t2.a4)
put4(t2, 400+4)
print(t1.a4, t2.a4)
put4(t1, 500+4)
print(t1.a4, t2.a4)
put4(t2, 600+4)
print(t1.a4, t2.a4)
put5(t1, 100+5)
print(t1.a5, t2.a5)
put5(t1, 200+5)
print(t1.a5, t2.a5)
put5(t2, 300+5)
print(t1.a5, t2.a5)
put5(t2, 400+5)
print(t1.a5, t2.a5)
put5(t1, 500+5)
print(t1.a5, t2.a5)
put5(t2, 600+5)
print(t1.a5, t2.a5)
put6(t1, 100+6)
print(t1.a6, t2.a6)
put6(t1, 200+6)
print(t1.a6, t2.a6)
put6(t2, 300+6)
print(t1.a6, t2.a6)
put6(t2, 400+6)
print(t1.a6, t2.a6)
put6(t1, 500+6)
print(t1.a6, t2.a6)
put6(t2, 600+6)
print(t1.a6, t2.a6)
put7(t1, 100+7)
print(t1.a7, t2.a7)
put7(t1, 200+7)
print(t1.a7, t2.a7)
put7(t2, 300+7)
print(t1.a7, t2.a7)
put7(t2, 400+7)
print(t1.a7, t2.a7)
put7(t1, 500+7)
print(t1.a7, t2.a7)
put7(t2, 600+7)
print(t1.a7, t2.a7)
put8(t1, 100+8)
print(t1.a8, t2.a8)
put8(t1, 200+8)
print(t1.a8, t2.a8)
put8(t2, 300+8)
print(t1.a8, t2.a8)
put8(t2, 400+8)
print(t1.a8, t2.a8)
put8(t1, 500+8)
print(t1.a8, t2.a8)
put8(t2, 600+8)
print(t1.a8, t2.a8)
put9(t1, 100+9)
print(t1.a9, t2.a9)
put9(t1, 200+9)
print(t1.a9, t2.a9)
put9(t2, 300+9)
print(t1.a9, t2.a9)
put9(t2, 400+9)
print(t1.a9, t2.a9)
put9(t1, 500+9)
print(t1.a9, t2.a9)
put9(t2, 600+9)
print(t1.a9, t2.a9)
put10(t1, 100+10)
print(t1.a10, t2.a10)
put10(t1, 200+10)
print(t1.a10, t2.a10)
put10(t2, 300+10)
print(t1.a10, t2.a10)
put10(t2, 400+10)
print(t1.a10, t2.a10)
put10(t1, 500+10)
print(t1.a10, t2.a10)
put10(t2, 600+10)
print(t1.a10, t2.a10)
put11(t1, 100+11)
print(t1.a11, t2.a11)
put11(t1, 200+11)
print(t1.a11, t2.a11)
put11(t2, 300+11)
print(t1.a11, t2.a11)
put11(t2, 400+11)
print(t1.a11, t2.a11)
put11(t1, 500+11)
print(t1.a11, t2.a11)
put11(t2, 600+11)
print(t1.a11, t2.a11)
put12(t1, 100+12)
print(t1.a12, t2.a12)
put12(t1, 200+12)
print(t1.a12, t2.a12)
put12(t2, 300+12)
print(t1.a12, t2.a12)
put12(t2, 400+12)
print(t1.a12, t2.a12)
put12(t1, 500+12)
print(t1.a12, t2.a12)
put12(t2, 600+12)
print(t1.a12, t2.a12)
put13(t1, 100+13)
print(t1.a13, t2.a13)
put13(t1, 200+13)
print(t1.a13, t2.a13)
put13(t2, 300+13)
print(t1.a13, t2.a13)
put13(t2, 400+13)
print(t1.a13, t2.a13)
put13(t1, 500+13)
print(t1.a13, t2.a13)
put13(t2, 600+13)
print(t1.a13, t2.a13)
put14(t1, 100+14)
print(t1.a14, t2.a14)
put14(t1, 200+14)
print(t1.a14, t2.a14)
put14(t2, 300+14)
print(t1.a14, t2.a14)
put14(t2, 400+14)
print(t1.a14, t2.a14)
put14(t1, 500+14)
print(t1.a14, t2.a14)
put14(t2, 600+14)
print(t1.a14, t2.a14)
put15(t1, 100+15)
print(t1.a15, t2.a15)
put15(t1, 200+15)
print(t1.a15, t2.a15)
put15(t2, 300+15)
print(t1.a15, t2.a15)
put15(t2, 400+15)
print(t1.a15, t2.a15)
put15(t1, 500+15)
print(t1.a15, t2.a15)
put15(t2, 600+15)
print(t1.a15, t2.a15)
put16(t1, 100+16)
print(t1.a16, t2.a16)
put16(t1, 200+16)
print(t1.a16, t2.a16)
put16(t2, 300+16)
print(t1.a16, t2.a16)
put16(t2, 400+16)
print(t1.a16, t2.a16)
put16(t1, 500+16)
print(t1.a16, t2.a16)
put16(t2, 600+16)
print(t1.a16, t2.a16)
put17(t1, 100+17)
print(t1.a17, t2.a17)
put17(t1, 200+17)
print(t1.a17, t2.a17)
put17(t2, 300+17)
print(t1.a17, t2.a17)
put17(t2, 400+17)
print(t1.a17, t2.a17)
put17(t1, 500+17)
print(t1.a17, t2.a17)
put17(t2, 600+17)
print(t1.a17, t2.a17)
put18(t1, 100+18)
print(t1.a18, t2.a18)
put18(t1, 200+18)
print(t1.a18, t2.a18)
put18(t2, 300+18)
print(t1.a18, t2.a18)
put18(t2, 400+18)
print(t1.a18, t2.a18)
put18(t1, 500+18)
print(t1.a18, t2.a18)
put18(t2, 600+18)
print(t1.a18, t2.a18)
put19(t1, 100+19)
print(t1.a19, t2.a19)
put19(t1, 200+19)
print(t1.a19, t2.a19)
put19(t2, 300+19)
print(t1.a19, t2.a19)
put19(t2, 400+19)
print(t1.a19, t2.a19)
put19(t1, 500+19)
print(t1.a19, t2.a19)
put19(t2, 600+19)
print(t1.a19, t2.a19)
put20(t1, 100+20)
print(t1.a20, t2.a20)
put20(t1, 200+20)
print(t1.a20, t2.a20)
put20(t2, 300+20)
print(t1.a20, t2.a20)
put20(t2, 400+20)
print(t1.a20, t2.a20)
put20(t1, 500+20)
print(t1.a20, t2.a20)
put20(t2, 600+20)
print(t1.a20, t2.a20)
put21(t1, 100+21)
print(t1.a21, t2.a21)
put21(t1, 200+21)
print(t1.a21, t2.a21)
put21(t2, 300+21)
print(t1.a21, t2.a21)
put21(t2, 400+21)
print(t1.a21, t2.a21)
put21(t1, 500+21)
print(t1.a21, t2.a21)
put21(t2, 600+21)
print(t1.a21, t2.a21)
put22(t1, 100+22)
print(t1.a22, t2.a22)
put22(t1, 200+22)
print(t1.a22, t2.a22)
put22(t2, 300+22)
print(t1.a22, t2.a22)
put22(t2, 400+22)
print(t1.a22, t2.a22)
put22(t1, 500+22)
print(t1.a22, t2.a22)
put22(t2, 600+22)
print(t1.a22, t2.a22)
put23(t1, 100+23)
print(t1.a23, t2.a23)
put23(t1, 200+23)
print(t1.a23, t2.a23)
put23(t2, 300+23)
print(t1.a23, t2.a23)
put23(t2, 400+23)
print(t1.a23, t2.a23)
put23(t1, 500+23)
print(t1.a23, t2.a23)
put23(t2, 600+23)
print(t1.a23, t2.a23)
put24(t1, 100+24)
print(t1.a24, t2.a24)
put24(t1, 200+24)
print(t1.a24, t2.a24)
put24(t2, 300+24)
print(t1.a24, t2.a24)
put24(t2, 400+24)
print(t1.a24, t2.a24)
put24(t1, 500+24)
print(t1.a24, t2.a24)
put24(t2, 600+24)
print(t1.a24, t2.a24)
put25(t1, 100+25)
print(t1.a25, t2.a25)
put25(t1, 200+25)
print(t1.a25, t2.a25)
put25(t2, 300+25)
print(t1.a25, t2.a25)
put25(t2, 400+25)
print(t1.a25, t2.a25)
put25(t1, 500+25)
print(t1.a25, t2.a25)
put25(t2, 600+25)
print(t1.a25, t2.a25)
put26(t1, 100+26)
print(t1.a26, t2.a26)
put26(t1, 200+26)
print(t1.a26, t2.a26)
put26(t2, 300+26)
print(t1.a26, t2.a26)
put26(t2, 400+26)
print(t1.a26, t2.a26)
put26(t1, 500+26)
print(t1.a26, t2.a26)
put26(t2, 600+26)
print(t1.a26, t2.a26)
put27(t1, 100+27)
print(t1.a27, t2.a27)
put27(t1, 200+27)
print(t1.a27, t2.a27)
put27(t2, 300+27)
print(t1.a27, t2.a27)
put27(t2, 400+27)
print(t1.a27, t2.a27)
put27(t1, 500+27)
print(t1.a27, t2.a27)
put27(t2, 600+27)
print(t1.a27, t2.a27)
put28(t1, 100+28)
print(t1.a28, t2.a28)
put28(t1, 200+28)
print(t1.a28, t2.a28)
put28(t2, 300+28)
print(t1.a28, t2.a28)
put28(t2, 400+28)
print(t1.a28, t2.a28)
put28(t1, 500+28)
print(t1.a28, t2.a28)
put28(t2, 600+28)
print(t1.a28, t2.a28)
put29(t1, 100+29)
print(t1.a29, t2.a29)
put29(t1, 200+29)
print(t1.a29, t2.a29)
put29(t2, 300+29)
print(t1.a29, t2.a29)
put29(t2, 400+29)
print(t1.a29, t2.a29)
put29(t1, 500+29)
print(t1.a29, t2.a29)
put29(t2, 600+29)
print(t1.a29, t2.a29)
put30(t1, 100+30)
print(t1.a30, t2.a30)
put30(t1, 200+30)
print(t1.a30, t2.a30)
put30(t2, 300+30)
print(t1.a30, t2.a30)
put30(t2, 400+30)
print(t1.a30, t2.a30)
put30(t1, 500+30)
print(t1.a30, t2.a30)
put30(t2, 600+30)
print(t1.a30, t2.a30)
put31(t1, 100+31)
print(t1.a31, t2.a31)
put31(t1, 200+31)
print(t1.a31, t2.a31)
put31(t2, 300+31)
print(t1.a31, t2.a31)
put31(t2, 400+31)
print(t1.a31, t2.a31)
put31(t1, 500+31)
print(t1.a31, t2.a31)
put31(t2, 600+31)
print(t1.a31, t2.a31)
put32(t1, 100+32)
print(t1.a32, t2.a32)
put32(t1, 200+32)
print(t1.a32, t2.a32)
put32(t2, 300+32)
print(t1.a32, t2.a32)
put32(t2, 400+32)
print(t1.a32, t2.a32)
put32(t1, 500+32)
print(t1.a32, t2.a32)
put32(t2, 600+32)
print(t1.a32, t2.a32)
put33(t1, 100+33)
print(t1.a33, t2.a33)
put33(t1, 200+33)
print(t1.a33, t2.a33)
put33(t2, 300+33)
print(t1.a33, t2.a33)
put33(t2, 400+33)
print(t1.a33, t2.a33)
put33(t1, 500+33)
print(t1.a33, t2.a33)
put33(t2, 600+33)
print(t1.a33, t2.a33)
put34(t1, 100+34)
print(t1.a34, t2.a34)
put34(t1, 200+34)
print(t1.a34, t2.a34)
put34(t2, 300+34)
print(t1.a34, t2.a34)
put34(t2, 400+34)
print(t1.a34, t2.a34)
put34(t1, 500+34)
print(t1.a34, t2.a34)
put34(t2, 600+34)
print(t1.a34, t2.a34)
put35(t1, 100+35)
print(t1.a35, t2.a35)
put35(t1, 200+35)
print(t1.a35, t2.a35)
put35(t2, 300+35)
print(t1.a35, t2.a35)
put35(t2, 400+35)
print(t1.a35, t2.a35)
put35(t1, 500+35)
print(t1.a35, t2.a35)
put35(t2, 600+35)
print(t1.a35, t2.a35)
put36(t1, 100+36)
print(t1.a36, t2.a36)
put36(t1, 200+36)
print(t1.a36, t2.a36)
put36(t2, 300+36)
print(t1.a36, t2.a36)
put36(t2, 400+36)
print(t1.a36, t2.a36)
put36(t1, 500+36)
print(t1.a36, t2.a36)
put36(t2, 600+36)
print(t1.a36, t2.a36)
put37(t1, 100+37)
print(t1.a37, t2.a37)
put37(t1, 200+37)
print(t1.a37, t2.a37)
put37(t2, 300+37)
print(t1.a37, t2.a37)
put37(t2, 400+37)
print(t1.a37, t2.a37)
put37(t1, 500+37)
print(t1.a37, t2.a37)
put37(t2, 600+37)
print(t1.a37, t2.a37)
put38(t1, 100+38)
print(t1.a38, t2.a38)
put38(t1, 200+38)
print(t1.a38, t2.a38)
put38(t2, 300+38)
print(t1.a38, t2.a38)
put38(t2, 400+38)
print(t1.a38, t2.a38)
put38(t1, 500+38)
print(t1.a38, t2.a38)
put38(t2, 600+38)
print(t1.a38, t2.a38)
put39(t1, 100+39)
print(t1.a39, t2.a39)
put39(t1, 200+39)
print(t1.a39, t2.a39)
put39(t2, 300+39)
print(t1.a39, t2.a39)
put39(t2, 400+39)
print(t1.a39, t2.a39)
put39(t1, 500+39)
print(t1.a39, t2.a39)
put39(t2, 600+39)
print(t1.a39, t2.a39)
put40(t1, 100+40)
print(t1.a40, t2.a40)
put40(t1, 200+40)
print(t1.a40, t2.a40)
put40(t2, 300+40)
print(t1.a40, t2.a40)
put40(t2, 400+40)
print(t1.a40, t2.a40)
put40(t1, 500+40)
print(t1.a40, t2.a40)
put40(t2, 600+40)
print(t1.a40, t2.a40)
put41(t1, 100+41)
print(t1.a41, t2.a41)
put41(t1, 200+41)
print(t1.a41, t2.a41)
put41(t2, 300+41)
print(t1.a41, t2.a41)
put41(t2, 400+41)
print(t1.a41, t2.a41)
put41(t1, 500+41)
print(t1.a41, t2.a41)
put41(t2, 600+41)
print(t1.a41, t2.a41)
put42(t1, 100+42)
print(t1.a42, t2.a42)
put42(t1, 200+42)
print(t1.a42, t2.a42)
put42(t2, 300+42)
print(t1.a42, t2.a42)
put42(t2, 400+42)
print(t1.a42, t2.a42)
put42(t1, 500+42)
print(t1.a42, t2.a42)
put42(t2, 600+42)
print(t1.a42, t2.a42)
put43(t1, 100+43)
print(t1.a43, t2.a43)
put43(t1, 200+43)
print(t1.a43, t2.a43)
put43(t2, 300+43)
print(t1.a43, t2.a43)
put43(t2, 400+43)
print(t1.a43, t2.a43)
put43(t1, 500+43)
print(t1.a43, t2.a43)
put43(t2, 600+43)
print(t1.a43, t2.a43)
put44(t1, 100+44)
print(t1.a44, t2.a44)
put44(t1, 200+44)
print(t1.a44, t2.a44)
put44(t2, 300+44)
print(t1.a44, t2.a44)
put44(t2, 400+44)
print(t1.a44, t2.a44)
put44(t1, 500+44)
print(t1.a44, t2.a44)
put44(t2, 600+44)
print(t1.a44, t2.a44)
put45(t1, 100+45)
print(t1.a45, t2.a45)
put45(t1, 200+45)
print(t1.a45, t2.a45)
put45(t2, 300+45)
print(t1.a45, t2.a45)
put45(t2, 400+45)
print(t1.a45, t2.a45)
put45(t1, 500+45)
print(t1.a45, t2.a45)
put45(t2, 600+45)
print(t1.a45, t2.a45)
put46(t1, 100+46)
print(t1.a46, t2.a46)
put46(t1, 200+46)
print(t1.a46, t2.a46)
put46(t2, 300+46)
print(t1.a46, t2.a46)
put46(t2, 400+46)
print(t1.a46, t2.a46)
put46(t1, 500+46)
print(t1.a46, t2.a46)
put46(t2, 600+46)
print(t1.a46, t2.a46)
put47(t1, 100+47)
print(t1.a47, t2.a47)
put47(t1, 200+47)
print(t1.a47, t2.a47)
put47(t2, 300+47)
print(t1.a47, t2.a47)
put47(t2, 400+47)
print(t1.a47, t2.a47)
put47(t1, 500+47)
print(t1.a47, t2.a47)
put47(t2, 600+47)
print(t1.a47, t2.a47)
put48(t1, 100+48)
print(t1.a48, t2.a48)
put48(t1, 200+48)
print(t1.a48, t2.a48)
put48(t2, 300+48)
print(t1.a48, t2.a48)
put48(t2, 400+48)
print(t1.a48, t2.a48)
put48(t1, 500+48)
print(t1.a48, t2.a48)
put48(t2, 600+48)
print(t1.a48, t2.a48)
put49(t1, 100+49)
print(t1.a49, t2.a49)
put49(t1, 200+49)
print(t1.a49, t2.a49)
put49(t2, 300+49)
print(t1.a49, t2.a49)
put49(t2, 400+49)
print(t1.a49, t2.a49)
put49(t1, 500+49)
print(t1.a49, t2.a49)
put49(t2, 600+49)
print(t1.a49, t2.a49)
put50(t1, 100+50)
print(t1.a50, t2.a50)
put50(t1, 200+50)
print(t1.a50, t2.a50)
put50(t2, 300+50)
print(t1.a50, t2.a50)
put50(t2, 400+50)
print(t1.a50, t2.a50)
put50(t1, 500+50)
print(t1.a50, t2.a50)
put50(t2, 600+50)
print(t1.a50, t2.a50)

end

print('-- test 1 --')
t1 = create_tab_1()
t2 = create_tab_1()
dotest_impl(t1, t2)
dotest_impl(t1, t2)

print('-- test 2 --')	
t1 = create_tab_2()
t2 = create_tab_2()
dotest_impl(t1, t2)
dotest_impl(t1, t2)

mt = {
	__newindex = function(tab, idx, val)
		print('in metamethod', idx, val)
		rawset(tab, idx, val)
	end
}

print('-- test 3 --')
t1 = create_tab_1()
t2 = create_tab_1()
setmetatable(t1, mt)
setmetatable(t2, mt)
dotest_impl(t1, t2)
dotest_impl(t1, t2)

print('-- test 4 --')
t1 = create_tab_2()
t2 = create_tab_2()
setmetatable(t1, mt)
setmetatable(t2, mt)
dotest_impl(t1, t2)
dotest_impl(t1, t2)

print('-- test 5 --')
t1 = create_tab_1()
t2 = create_tab_1()
dotest_impl(t1, t2)
setmetatable(t1, mt)
setmetatable(t2, mt)
dotest_impl(t1, t2)

print('-- test 6 --')
t1 = create_tab_2()
t2 = create_tab_2()
dotest_impl(t1, t2)
setmetatable(t1, mt)
setmetatable(t2, mt)
dotest_impl(t1, t2)

